/* Mobile-Specific Optimizations for BR2049 Interface */
/* Advanced mobile performance and UX improvements */

:root {
  /* Dynamic viewport variables */
  --viewport-height: 100vh;
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-left: env(safe-area-inset-left, 0px);
  --safe-area-right: env(safe-area-inset-right, 0px);
  
  /* Mobile touch optimization */
  --touch-target-min: 44px;
  --touch-padding: 12px;
  --mobile-font-scale: 1.1;
  
  /* Performance optimization variables */
  --mobile-animation-duration: 200ms;
  --mobile-transition-timing: ease-out;
  --mobile-blur-radius: 8px; /* Reduced for performance */
}

/* Global mobile optimizations */
@media (max-width: 768px) {
  * {
    /* Improve scrolling performance */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: none;
    
    /* Optimize touch interactions */
    touch-action: manipulation;
    
    /* Prevent text selection issues on touch */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Re-enable text selection for content areas */
  .window-content, .menu-dropdown, input, textarea {
    -webkit-user-select: auto;
    -moz-user-select: auto;
    -ms-user-select: auto;
    user-select: auto;
  }
}

/* Mobile viewport optimizations */
@media (max-width: 768px) {
  .app {
    /* Use dynamic viewport height for mobile browsers */
    min-height: var(--viewport-height);
    height: var(--viewport-height);
    
    /* Prevent overscroll bounce */
    overscroll-behavior-y: none;
    
    /* Optimize rendering */
    contain: layout style paint;
    will-change: transform;
  }
  
  .desktop-background {
    /* Ensure background covers dynamic viewport */
    height: var(--viewport-height) !important;
  }
}

/* Touch target optimizations */
@media (max-width: 768px) {
  .dock-item {
    /* Ensure minimum touch target size */
    min-width: var(--touch-target-min);
    min-height: var(--touch-target-min);
    
    /* Add touch padding without affecting visual design */
    padding: var(--touch-padding);
    margin: -var(--touch-padding);
    
    /* Improve touch responsiveness */
    cursor: default; /* Remove hover cursor on touch devices */
  }
  
  .window-control {
    /* Larger touch targets for window controls */
    min-width: 32px;
    min-height: 32px;
    
    /* Better touch feedback */
    transition: background-color var(--mobile-animation-duration) var(--mobile-transition-timing);
  }
  
  .menu-title {
    /* Larger touch targets for menu items */
    min-height: var(--touch-target-min);
    line-height: var(--touch-target-min);
    padding: 0 16px;
  }
}

/* Mobile performance optimizations */
@media (max-width: 768px) {
  /* Reduce visual complexity for performance */
  .window-glow, .dock-item-glow {
    display: none; /* Hide resource-intensive glows on mobile */
  }
  
  /* Simplify shadows for performance */
  .window, .dock, .menubar {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
    backdrop-filter: blur(var(--mobile-blur-radius)) !important;
  }
  
  /* Optimize animations */
  * {
    animation-duration: var(--mobile-animation-duration) !important;
    transition-duration: var(--mobile-animation-duration) !important;
    transition-timing-function: var(--mobile-transition-timing) !important;
  }
  
  /* Disable hover effects that don't work on touch */
  .dock-item:hover, .menu-title:hover, .window-control:hover {
    transform: none !important;
    scale: none !important;
  }
}

/* Low-end mobile optimizations */
@media (max-width: 768px) and (max-resolution: 1.5dppx) {
  /* Further reduce visual effects for low-DPI screens */
  .particle-field, .fluid-effect {
    opacity: 0.3 !important;
  }
  
  /* Simplify complex backgrounds */
  .desktop-background::before {
    display: none;
  }
  
  /* Reduce animation complexity */
  .dock-item .br2049-icon * {
    animation: none !important;
  }
}

/* High-DPI mobile optimizations */
@media (max-width: 768px) and (min-resolution: 3dppx) {
  /* Optimize for very high-DPI screens like iPhone Pro */
  .window-content, .dock-content {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
  
  /* Scale UI elements slightly for better touch accuracy */
  .dock-item {
    transform: scale(var(--mobile-font-scale));
  }
}

/* Landscape mobile optimizations */
@media (max-width: 768px) and (orientation: landscape) {
  .dock-container {
    /* Adjust dock positioning for landscape */
    bottom: max(20px, var(--safe-area-bottom));
  }
  
  .menubar {
    /* Reduce menu bar height in landscape */
    height: 32px;
  }
  
  .window {
    /* Optimize window sizing for landscape */
    top: 32px !important;
    height: calc(var(--viewport-height) - 32px - 80px) !important;
  }
}

/* iOS-specific optimizations */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    /* iOS Safari optimizations */
    .app {
      /* Prevent rubber band scrolling */
      overscroll-behavior: none;
      -webkit-overflow-scrolling: touch;
    }
    
    /* Fix iOS viewport height issues */
    .desktop, .window {
      height: var(--viewport-height);
    }
    
    /* iOS-specific touch optimizations */
    .dock-item, .window-control, .menu-title {
      -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
      -webkit-touch-callout: none;
    }
  }
}

/* Android-specific optimizations */
@media (max-width: 768px) and (-webkit-min-device-pixel-ratio: 1) {
  /* Android Chrome optimizations */
  .app {
    /* Address bar handling */
    min-height: 100vh;
    min-height: var(--viewport-height);
  }
  
  /* Android touch optimizations */
  .dock-item {
    /* Better touch feedback on Android */
    outline: none;
    -webkit-tap-highlight-color: rgba(0, 255, 255, 0.2);
  }
}

/* Accessibility optimizations for mobile */
@media (max-width: 768px) {
  /* Improve accessibility on mobile devices */
  .dock-item, .window-control, .menu-title {
    /* Larger text for better readability */
    font-size: calc(1em * var(--mobile-font-scale));
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .dock-item, .window, .menubar {
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}

/* Force GPU acceleration on supported mobile devices */
@media (max-width: 768px) {
  .app, .desktop, .dock, .window, .particle-field, .fluid-effect {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000;
  }
}

/* Memory-conscious media queries for very low-end devices */
@media (max-width: 480px) and (max-height: 800px) {
  /* Ultra-low-end mobile optimizations */
  .tracking-overlay, .environmental-monitor {
    display: none !important; /* Hide complex overlays */
  }
  
  .particle-field {
    opacity: 0.1 !important; /* Minimal particle effects */
  }
  
  .dock-item .br2049-icon {
    /* Simplify icons to basic shapes */
    filter: none !important;
  }
}